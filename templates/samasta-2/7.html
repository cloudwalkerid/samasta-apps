<!-- Breadcrumb-->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-fixed">
    <li class="breadcrumb-item">
      <nav>
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="#">Halaman</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,1)" tabindex="-1">1</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,2)" tabindex="-1">2</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,3)" tabindex="-1">3</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,4)" tabindex="-1">4</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,5)" tabindex="-1">5</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,6)" tabindex="-1">6</a>
          </li>
          <li class="page-item active">
            <a class="page-link" href="#">7</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(7,8)" tabindex="-1">8</a>
          </li>
        </ul>
      </nav>
    </li>
    <li class="ml-auto">
      <div class="btn-group" role="group" style="padding-right: 50px">
        <button class="btn btn-success" onclick="simpanEntrian()">Simpan</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#tutupEntrianModal">Tutup</button>
      </div>
    </li>
  </ol>
</nav>

<div class="container-fluid">
  <div class="animated fadeIn">
    <!-- /.row-->
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body" style="margin-top: 50px">
            <div class="row">
              <div class="col-sm-12 d-none d-md-block">
                <table id="tableHal7Blok5_1" class="table table-bordered table-sm table-hover">
                  <thead>
                    <tr>
                      <th class="judulBlokKuesioner" colspan="10">BLOK V. KETERANGAN KEPALA KELUARGA</th>
                    </tr>
                    <tr>
                      <th rowspan="3" style='width:40px'>No Urut KK</th>
                      <th rowspan="3" style="width: 350px">Nama Kepala Keluarga</th>
                      <th colspan="4">MOBILITAS PENDUDUK</th>
                      <th colspan="4">NTCR</th>
                    </tr>
                    <tr>
                      <th colspan="4">Jumlah orang di keluarga ini setahun terakhir</th>
                      <th colspan="4">Jumlah kejadian perkawinan di keluarga ini setahun terakhir</th>
                    </tr>
                    <tr>
                      <th>Lahir</th>
                      <th>Mati</th>
                      <th>Datang</th>
                      <th>Pindah</th>
                      <th>Nikah</th>
                      <th>Talak</th>
                      <th>Cerai</th>
                      <th>Rujuk</th>
                    </tr>
                    <tr class="nomorKolomKuesioner">
                      <th>(501)</th>
                      <th>(502)</th>
                      <th>(503)</th>
                      <th>(504)</th>
                      <th>(505)</th>
                      <th>(506)</th>
                      <th>(507)</th>
                      <th>(508)</th>
                      <th>(509)</th>
                      <th>(510)</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyBarisKK_a">
                  </tbody>
                </table>
              </div>

              <div class="col-sm-12 d-none d-md-block">
                <table id="tableHal7Blok5_2" class="table table-bordered table-sm table-hover">
                  <thead>
                    <tr>
                      <th rowspan="3" style='width:40px'>No Urut KK</th>
                      <th colspan="14">TRANSPORTASI</th>
                    </tr>
                    <tr>
                      <th colspan="14">Jumlah kendaraan yang dimiliki/dikuasai keluarga</th>
                    </tr>
                    <tr>
                      <th>Sepeda</th>
                      <th>Gerobak</th>
                      <th>Kendaraan roda tiga (tosa)</th>
                      <th>Becak</th>
                      <th>Becak motor</th>
                      <th>Sepeda motor</th>
                      <th>Oplet/ mikrolet</th>
                      <th>Colt bak</th>
                      <th>Taksi</th>
                      <th>Mobil/ sepeda motor dinas</th>
                      <th>Mobil pribadi</th>
                      <th>Truk</th>
                      <th>Perahu</th>
                      <th>Lainnya</th>
                    </tr>
                    <tr class="nomorKolomKuesioner">
                      <th>(501)</th>
                      <th>(511)</th>
                      <th>(512)</th>
                      <th>(513)</th>
                      <th>(514)</th>
                      <th>(515)</th>
                      <th>(516)</th>
                      <th>(517)</th>
                      <th>(518)</th>
                      <th>(519)</th>
                      <th>(520)</th>
                      <th>(521)</th>
                      <th>(522)</th>
                      <th>(523)</th>
                      <th>(524)</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyBarisKK_b">
                  </tbody>
                </table>
              </div>

            </div>
            <!-- /.row-->
          </div>
        </div>
      </div>
      <!-- /.col-->
    </div>
    <!-- /.row-->
  </div>
</div>

<!-- modal tutupEntrianModal -->
<div class="modal fade" id="tutupEntrianModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Konfirmasi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Apakah anda ingin menyimpan perubahan data?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="tutupEntrian('yes')">Simpan</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="tutupEntrian('no')">Tidak</button>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    //$('.sidebar-toggler').click();
    loadEntrian();
  });
</script>

<script>
  var namaFile;
  var statusEntrian;
  var RTdata;

  function loadEntrian() {
    getEntriSessionData();
    bacaIsiJsonRT();
    
    arrArtAsKK = [];

    for (var i = 0; i < kkPage7.length; i++) {
      $('#tbodyBarisKK_a').append(`<tr class='barisKK_a'>`
        + `<td><input class='form-control text-center text-middle k501' value='${kkPage7[i].k501}' id='k501[${i}]' style='width:40px' disabled></input>
                <input class='form-control nuArtGuid' type='hidden' value='${kkPage7[i].nuArtGuid}' id='nuArtGuid[${i}]'></input>
            </td>`
        + `<td><input class='form-control form-kuesioner k502' id='k502[${i}]' value='${kkPage7[i].k502}' onfocus='this.select();' disabled></input></td>`
        //+ `<td><select class='form-control form-kuesioner k502' id='k502[${i}]'></select></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k503' id='k503[${i}]' value='${kkPage7[i].k503}' tabindex='${8 * (i) + 1}' maxlength='2' autofocus onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k504' id='k504[${i}]' value='${kkPage7[i].k504}' tabindex='${8 * (i) + 2}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k505' id='k505[${i}]' value='${kkPage7[i].k505}' tabindex='${8 * (i) + 3}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k506' id='k506[${i}]' value='${kkPage7[i].k506}' tabindex='${8 * (i) + 4}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k507' id='k507[${i}]' value='${kkPage7[i].k507}' tabindex='${8 * (i) + 5}' maxlength='1' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k508' id='k508[${i}]' value='${kkPage7[i].k508}' tabindex='${8 * (i) + 6}' maxlength='1' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k509' id='k509[${i}]' value='${kkPage7[i].k509}' tabindex='${8 * (i) + 7}' maxlength='1' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k510' id='k510[${i}]' value='${kkPage7[i].k510}' tabindex='${8 * (i) + 8}' maxlength='1' onfocus='this.select();'></input></td>`
        + `</tr>`);
    }
    for (var i = 0; i < kkPage7.length; i++) {
      var a = kkPage7.length;
      $('#tbodyBarisKK_b').append(`<tr class='barisKK_b'>`
        + `<td><input class='form-control text-center text-middle k501' value='${kkPage7[i].k501}' id='k501[${i}]' style='width:40px' disabled>
                  </input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k511' id='k511[${i}]' value='${kkPage7[i].k511}' tabindex='${8 * (a) + (14 * (i) + 1)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k512' id='k512[${i}]' value='${kkPage7[i].k512}' tabindex='${8 * (a) + (14 * (i) + 2)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k513' id='k513[${i}]' value='${kkPage7[i].k513}' tabindex='${8 * (a) + (14 * (i) + 3)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k514' id='k514[${i}]' value='${kkPage7[i].k514}' tabindex='${8 * (a) + (14 * (i) + 4)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k515' id='k515[${i}]' value='${kkPage7[i].k515}' tabindex='${8 * (a) + (14 * (i) + 5)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k516' id='k516[${i}]' value='${kkPage7[i].k516}' tabindex='${8 * (a) + (14 * (i) + 6)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k517' id='k517[${i}]' value='${kkPage7[i].k517}' tabindex='${8 * (a) + (14 * (i) + 7)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k518' id='k518[${i}]' value='${kkPage7[i].k518}' tabindex='${8 * (a) + (14 * (i) + 8)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k519' id='k519[${i}]' value='${kkPage7[i].k519}' tabindex='${8 * (a) + (14 * (i) + 9)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k520' id='k520[${i}]' value='${kkPage7[i].k520}' tabindex='${8 * (a) + (14 * (i) + 10)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k521' id='k521[${i}]' value='${kkPage7[i].k521}' tabindex='${8 * (a) + (14 * (i) + 11)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k522' id='k522[${i}]' value='${kkPage7[i].k522}' tabindex='${8 * (a) + (14 * (i) + 12)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k523' id='k523[${i}]' value='${kkPage7[i].k523}' tabindex='${8 * (a) + (14 * (i) + 13)}' maxlength='2' onfocus='this.select();'></input></td>`
        + `<td><input class='form-control form-kuesioner text-center rgxAngka k524' id='k524[${i}]' value='${kkPage7[i].k524}' tabindex='${8 * (a) + (14 * (i) + 14)}' maxlength='2' onfocus='this.select();' onkeypress='nextPage(${i}, event)'></input></td>`
        + `</tr>`);
    }
    document.getElementsByClassName("k503")[0].focus();
    tabindexFix();
  }

  function pindahHalaman(from, to) {
    if (from == 7) {
      updateIsiJsonRT();
    }
    location.href = `#/samasta-2/${to}/`;
  }
</script>

<script>
  function nextPage(i, e) {
    var maxTabIndex = 22 * (kkPage7.length - 1) + 22;
    console.log(maxTabIndex);
    var keycode = (e.keyCode ? e.keyCode : e.which);
    if (keycode == '13') {
      if (document.getElementsByClassName('k524')[i].tabIndex == maxTabIndex) {
        updateIsiJsonRT();
        location.href = `#/samasta-2/8/`;
      }
    }
  }
</script>

<script>
  // =====================================================================================================//
  function updateIsiJsonRT() {
    // artPage2 diupdate berdasarkan entrian, Page yang lainnya tetap sesuai yang tersimpan di file RT Json
    var barisKK = document.getElementsByClassName('barisKK_a');
    kkPage7 = [];
    for (i = 0; i < barisKK.length; i++) {
      kkPage7.push({
        'k501': document.getElementsByClassName('k501')[i].value,
        'nuArtGuid': document.getElementsByClassName('nuArtGuid')[i].value,
        'k502': document.getElementsByClassName('k502')[i].value,
        'k503': document.getElementsByClassName('k503')[i].value,
        'k504': document.getElementsByClassName('k504')[i].value,
        'k505': document.getElementsByClassName('k505')[i].value,
        'k506': document.getElementsByClassName('k506')[i].value,
        'k507': document.getElementsByClassName('k507')[i].value,
        'k508': document.getElementsByClassName('k508')[i].value,
        'k509': document.getElementsByClassName('k509')[i].value,
        'k510': document.getElementsByClassName('k510')[i].value,
        'k511': document.getElementsByClassName('k511')[i].value,
        'k512': document.getElementsByClassName('k512')[i].value,
        'k513': document.getElementsByClassName('k513')[i].value,
        'k514': document.getElementsByClassName('k514')[i].value,
        'k515': document.getElementsByClassName('k515')[i].value,
        'k516': document.getElementsByClassName('k516')[i].value,
        'k517': document.getElementsByClassName('k517')[i].value,
        'k518': document.getElementsByClassName('k518')[i].value,
        'k519': document.getElementsByClassName('k519')[i].value,
        'k520': document.getElementsByClassName('k520')[i].value,
        'k521': document.getElementsByClassName('k521')[i].value,
        'k522': document.getElementsByClassName('k522')[i].value,
        'k523': document.getElementsByClassName('k523')[i].value,
        'k524': document.getElementsByClassName('k524')[i].value
      });
    }

    RTdata.artPage2 = artPage2;
    RTdata.artPage3 = artPage3;
    RTdata.artPage4 = artPage4;
    RTdata.artPage5 = artPage5;
    RTdata.artPage6 = artPage6;
    RTdata.kkPage7 = kkPage7;
    RTdata.kkPage8 = kkPage8;
    RTdata.statusDok = statusDok;
    fs.writeFileSync(dlPathData + `entriSamasta2/${namaFile}.json`, JSON.stringify(RTdata));
  }
</script>

<script>
  $(document).ready(function () {
    // Install input filters.    
    $(".rgxAngka").inputFilter(function (value) {
      return /^\d*$/.test(value);
    });
  });
</script>