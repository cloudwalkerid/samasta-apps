<!-- Breadcrumb-->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-fixed">
    <li class="breadcrumb-item">
      <nav>
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="#">Halaman</a>
          </li>
          <li class="page-item active">
            <a class="page-link" href="#">1</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,2)" tabindex="16">2</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,3)" tabindex="17">3</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,4)" tabindex="18">4</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,5)" tabindex="19">5</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,6)" tabindex="20">6</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,7)" tabindex="21">7</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,8)" tabindex="22">8</a>
          </li>
        </ul>
      </nav>
    </li>
    <li class="ml-auto">
      <div class="btn-group" role="group" style="padding-right: 50px">
        <button class="btn btn-success" onclick="simpanEntrian()">Simpan</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#tutupEntrianModal">Tutup</button>
      </div>
    </li>
  </ol>
</nav>

<div class="container-fluid">
  <div class="animated fadeIn">
    <!-- /.row-->
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!--<div class="card-header">
          </div>-->
          <div class="card-body" style="margin-top: 50px">

            <div class="row">
              <div class="col-sm-3 d-none d-md-block text-center">
                <img src="assets/images/logobps.png" width="40%">
              </div>
              <div class="col-sm-6 d-none d-md-block text-center">
                <img src="assets/images/logosamasta.jpeg" width="25%">
                <b>
                  <h3>PENDATAAN DESA MANDIRI STATISTIK 2019</h3>
                </b>
                <b>KETERANGAN ANGGOTA RUMAH TANGGA</b>
              </div>
              <div class="col-sm-3 d-none d-md-block text-center">
                <img src="assets/images/logosulbar.png" width="25%"><br>
                <b>SAMASTA-2</b>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-8 d-none d-md-block">
                <br>
                <table class="table table-responsive-sm table-bordered table-sm table-hover">
                  <thead>
                    <tr class="judulBlokKuesioner">
                      <th colspan="3"><b>BLOK I. KETERANGAN TEMPAT</b></th>
                    </tr>
                  </thead>
                  <tbody id="tbodyOperator">
                    <tr>
                      <td width="5%" class="text-center">101</td>
                      <td width="35%">Provinsi</td>
                      <td width="60%"><input class="form-control form-kuesioner" id="b1r101" tabindex="-1" value=""
                          disabled></input>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-center">102</td>
                      <td>Kabupaten/Kota *)</td>
                      <td><input class="form-control form-kuesioner" id="b1r102" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">103</td>
                      <td>Kecamatan</td>
                      <td><input class="form-control form-kuesioner" id="b1r103" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">104</td>
                      <td>Desa/Kelurahan *)</td>
                      <td><input class="form-control form-kuesioner" id="b1r104" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">105</td>
                      <td>Dusun/Lingkungan</td>
                      <td><input class="form-control form-kuesioner" id="b1r105" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">106</td>
                      <td>Nama Kepala Rumah Tangga</td>
                      <td><input class="form-control form-kuesioner" id="b1r106" tabindex="1" onfocus='this.select();'
                          autofocus></input>
                    </tr>
                    <tr>
                      <td class="text-center">107</td>
                      <td>Nama Alias</td>
                      <td><input class="form-control form-kuesioner" id="b1r107" tabindex="2"
                          onfocus='this.select();'></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">108</td>
                      <td>Alamat</td>
                      <td><textarea class="form-control form-kuesioner" id="b1r108" tabindex="3"
                          onfocus='this.select();'></textarea></td>
                    </tr>
                    <tr>
                      <td class="text-center">109</td>
                      <td>Nomor Handphone</td>
                      <td><input class="form-control form-kuesioner" id="b1r109" tabindex="4" maxlength="14"
                          onfocus='this.select();'></input></td>
                    </tr>
                  </tbody>
                </table>
                *) Coret yang tidak perlu
                <br>
                <br>
                <table class="table table-responsive-sm table-bordered table-sm table-hover">
                  <thead>
                    <tr>
                      <th colspan="3" class="judulBlokKuesioner"><b>BLOK II. KETERANGAN PETUGAS</b></th>
                    </tr>
                    <tr>
                      <th width="40%" class="text-center">Uraian</th>
                      <th width="30%" class="text-center">Pendata</th>
                      <th width="30%" class="text-center">Pemeriksa</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>201. Nama</td>
                      <td><input class="form-control form-kuesioner text-center" id="b2r201a" tabindex="5"
                          onfocus='this.select();'></input></td>
                      <td><input class="form-control form-kuesioner text-center" id="b2r201b" tabindex="6"
                          onfocus='this.select();'></input></td>
                    </tr>
                    <tr>
                      <td>202. Tanggal Pelaksanaan</td>
                      <td>
                        <table class="table-borderless">
                          <tr>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_dd" tabindex="7"
                                onfocus='this.select();' style="width: 50px" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_mm" tabindex="8"
                                onfocus='this.select();' style="width: 50px" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_yy" tabindex="9"
                                onfocus='this.select();' style="width: 80px" maxlength="4"></input>
                            </td>
                          </tr>
                        </table>
                      </td>
                      <td>
                        <table class="table-borderless">
                          <tr>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_dd" tabindex="10"
                                onfocus='this.select();' style="width: 50px" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_mm" tabindex="11"
                                onfocus='this.select();' style="width: 50px" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_yy" tabindex="12"
                                onfocus='this.select();' style="width: 80px" maxlength="4"></input>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                    <tr>
                      <td>203. Tanda Tangan</td>
                      <td class="text-center">ttd</input>
                      </td>
                      <td class="text-center">ttd</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="col-sm-4 d-none d-md-block">
                <br>
                <table id="dtHorizontalVerticalExample" class="table table-bordered table-sm table-hover">
                  <thead>
                    <tr class="judulBlokKuesioner">
                      <th>BLOK III. CATATAN</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-center"><textarea class="form-control form-kuesioner"
                          style="width: 100%; height: 655px;" id="b3catatan" tabindex="13" onfocus='this.select();'
                          onkeypress='nextPage(13, event)'></textarea></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- /.row-->
        </div>
      </div>
    </div>
    <!-- /.col-->
  </div>
  <!-- /.row-->
</div>
</div>

<!-- modal tutupEntrianModal -->
<div class="modal fade" id="tutupEntrianModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Konfirmasi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Apakah anda ingin menyimpan perubahan data?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="tutupEntrian('yes')">Simpan</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="tutupEntrian('no')">Tidak</button>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    //$('.sidebar-toggler').click();
    loadEntrian();
    //document.getElementById("loader").style.display = "none";
    $(".overlay").hide();
  });
</script>

<script>
  async function loadEntrian() {
    getEntriSessionData();
    bacaIsiJsonRT();

    let sql = `SELECT * FROM m_sls AS e 
          LEFT JOIN m_prov AS a ON e.kodeProv = a.kodeProv 
          LEFT JOIN m_kab AS b ON e.kodeProv = b.kodeProv AND e.kodeKab = b.kodeKab
          LEFT JOIN m_kec AS c ON e.kodeProv = c.kodeProv AND e.kodeKab = c.kodeKab AND e.kodeKec = c.kodeKec
          LEFT JOIN m_desa AS d ON e.kodeProv = d.kodeProv AND e.kodeKab = d.kodeKab AND e.kodeKec = d.kodeKec AND e.kodeDesa = d.kodeDesa
          WHERE e.kodeProv = '${kodeProv}' AND e.kodeKab  = '${kodeKab}' AND e.kodeKec = '${kodeKec}' AND e.kodeDesa = '${kodeDesa}' AND e.kodeSLS = '${kodeSLS}'`;
    row = await sqlite.get(sql);
    if (row) {
      document.getElementById('b1r101').value = row.namaProv;
      document.getElementById('b1r102').value = row.namaKab;
      document.getElementById('b1r103').value = row.namaKec;
      document.getElementById('b1r104').value = row.namaDesa;
      document.getElementById('b1r105').value = row.namaSLS;
      document.getElementById('b1r106').value = b1r106;
      document.getElementById('b1r107').value = b1r107;
      document.getElementById('b1r108').value = b1r108;
      document.getElementById('b1r109').value = b1r109;
      document.getElementById('b2r201a').value = b2r201a;
      document.getElementById('b2r201b').value = b2r201b;
      document.getElementById('b2r202a_dd').value = b2r202a_dd;
      document.getElementById('b2r202a_mm').value = b2r202a_mm;
      document.getElementById('b2r202a_yy').value = b2r202a_yy;
      document.getElementById('b2r202b_dd').value = b2r202b_dd;
      document.getElementById('b2r202b_mm').value = b2r202b_mm;
      document.getElementById('b2r202b_yy').value = b2r202b_yy;
      document.getElementById('b3catatan').value = b3catatan;
    }
    document.getElementById("b1r106").focus();
  }

  function updateIsiJsonRT() {
    const fs = require('fs');

    let rawdata = fs.readFileSync(dlPathData + `entriSamasta2/${namaFile}.json`);
    let RTdata = JSON.parse(rawdata);

    RTdata.b1r106 = document.getElementById("b1r106").value.toUpperCase();
    RTdata.b1r107 = document.getElementById("b1r107").value.toUpperCase();
    RTdata.b1r108 = document.getElementById("b1r108").value.toUpperCase();
    RTdata.b1r109 = document.getElementById("b1r109").value.toUpperCase();
    RTdata.b2r201a = document.getElementById("b2r201a").value.toUpperCase();
    RTdata.b2r201b = document.getElementById("b2r201b").value.toUpperCase();
    RTdata.b2r202a_dd = document.getElementById("b2r202a_dd").value;
    RTdata.b2r202a_mm = document.getElementById("b2r202a_mm").value;
    RTdata.b2r202a_yy = document.getElementById("b2r202a_yy").value;
    RTdata.b2r202b_dd = document.getElementById("b2r202b_dd").value;
    RTdata.b2r202b_mm = document.getElementById("b2r202b_mm").value;
    RTdata.b2r202b_yy = document.getElementById("b2r202b_yy").value;
    RTdata.b3catatan = document.getElementById("b3catatan").value.toUpperCase();
    RTdata.statusDok = statusDok;

    fs.writeFileSync(dlPathData + `entriSamasta2/${namaFile}.json`, JSON.stringify(RTdata));
  }
</script>

<script>
  function pindahHalaman(from, to) {
    if (from == 1) {
      updateIsiJsonRT();
    }
    location.href = `#/samasta-2/${to}/`;
  }
</script>

<script>
  function nextPage(i, e) {
    var maxTabIndex = i;
    var keycode = (e.keyCode ? e.keyCode : e.which);
    if (keycode == '13') {
      if (document.getElementById('b3catatan').tabIndex == maxTabIndex) {
        updateIsiJsonRT();
        location.href = `#/samasta-2/2/`;
      }
    }
  }
</script>

<script>
  tabindexFix();
</script>

<script>
  $(document).ready(function () {
    // Install input filters.
    $("#b1r106").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b1r107").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b1r108").inputFilter(function (value) {
      return /^[a-zA-Z0-9 .,/]*$/i.test(value);
    });
    $("#b1r109").inputFilter(function (value) {
      return /^\d*$/.test(value);
    });
    $("#b2r201a").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b2r201b").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b2r202a_dd").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 31);
    });
    $("#b2r202a_mm").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 12);
    });
    $("#b2r202a_yy").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 2100);
    });
    $("#b2r202b_dd").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 31);
    });
    $("#b2r202b_mm").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 12);
    });
    $("#b2r202b_yy").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 2100);
    });
    $("#b3catatan").inputFilter(function (value) {
      return /^[a-zA-Z0-9 .,/?()+=-@:&]*$/i.test(value);
    });
  });
</script>