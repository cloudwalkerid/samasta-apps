<!-- Breadcrumb-->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-fixed">
    <li class="breadcrumb-item">
      <nav>
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="#">Halaman</a>
          </li>
          <li class="page-item active">
            <a class="page-link" href="#">1</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,2)">2</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,3)">3</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,4)">4</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,5)">5</a>
          </li>
          <li class="page-item">
            <a class="page-link" onclick="pindahHalaman(1,6)">6</a>
          </li>
        </ul>
      </nav>
    </li>
    <li class="ml-auto">
      <div class="btn-group" role="group" style="padding-right: 50px">
        <button class="btn btn-success" onclick="simpanEntrianSamasta1()">Simpan</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#tutupEntrianModal">Tutup</button>
      </div>
    </li>
  </ol>
</nav>

<div class="container-fluid">
  <div class="animated fadeIn">
    <!-- /.row-->
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!--<div class="card-header">
          </div>-->
          <div class="card-body" style="margin-top: 50px">

            <div class="row">
              <div class="col-sm-3 d-none d-md-block" style="text-align: center">
                <img src="assets/images/logobps.png" width="40%">
              </div>
              <div class="col-sm-6 d-none d-md-block" style="text-align: center">
                <img src="assets/images/logosamasta.jpeg" width="25%">
                <b>
                  <h3>PENDATAAN DESA MANDIRI STATISTIK 2019</h3>
                </b>
                <b>KETERANGAN DESA/KELURAHAN</b>
              </div>
              <div class="col-sm-3 d-none d-md-block" style="text-align: center">
                <img src="assets/images/logosulbar.png" width="25%"><br>
                <b>SAMASTA-1</b>
              </div>

              <div class="col-sm-12 d-none d-md-block">
                <br>
                <table class="table table-responsive-sm table-bordered table-sm table-hover">
                  <thead>
                    <tr class="judulBlokKuesioner">
                      <th colspan="3"><b>BLOK I. KETERANGAN TEMPAT</b></th>
                    </tr>
                  </thead>
                  <tbody id="tbodyOperator">
                    <tr>
                      <td width="5%" class="text-center">101</td>
                      <td width="25%">Provinsi</td>
                      <td width="70%"><input class="form-control form-kuesioner" id="b1r101" tabindex="-1"
                          disabled></input>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-center">102</td>
                      <td>Kabupaten/Kota *)</td>
                      <td><input class="form-control form-kuesioner" id="b1r102" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">103</td>
                      <td>Kecamatan</td>
                      <td><input class="form-control form-kuesioner" id="b1r103" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">104</td>
                      <td>Desa/Kelurahan *)</td>
                      <td><input class="form-control form-kuesioner" id="b1r104" tabindex="-1" disabled></input></td>
                    </tr>
                    <tr>
                      <td class="text-center">105</td>
                      <td>Alamat Kantor Desa/Kelurahan</td>
                      <td><textarea class="form-control form-kuesioner" id="b1r105" tabindex="1" autofocus
                          onfocus='this.select();' style="width: 100%; height: 60px"></textarea></td>
                    </tr>
                  </tbody>
                </table>
                *) Coret yang tidak perlu
                <br>
                <br>
                <table class="table table-responsive-sm table-bordered table-sm table-hover">
                  <thead>
                    <tr class="judulBlokKuesioner">
                      <th colspan="3"><b>BLOK II. KETERANGAN PETUGAS</b></th>
                    </tr>
                    <tr>
                      <th width="30%">Uraian</th>
                      <th width="35%">Pendata</th>
                      <th width="35%">Pemeriksa</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyOperator">
                    <tr>
                      <td>201. Nama</td>
                      <td><input class="form-control form-kuesioner" id="b2r201a" tabindex="2" onfocus='this.select();'
                          maxlength="50"></input></td>
                      <td><input class="form-control form-kuesioner" id="b2r201b" tabindex="3" onfocus='this.select();'
                          maxlength="50"></input></td>
                    </tr>
                    <tr>
                      <td>202. Tanggal Pelaksanaan</td>
                      <td>
                        <table class="table-borderless">
                          <tr>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_dd" tabindex="4"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_mm" tabindex="5"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202a_yy" tabindex="6"
                                onfocus='this.select();' style="width: 80px" maxlength="4" maxlength="4"></input>
                            </td>
                          </tr>
                        </table>
                      </td>
                      <td>
                        <table class="table-borderless">
                          <tr>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_dd" tabindex="7"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_mm" tabindex="8"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b2r202b_yy" tabindex="9"
                                onfocus='this.select();' style="width: 80px" maxlength="4" maxlength="4"></input>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                    <tr>
                      <td>203. Nomor HP</td>
                      <td><input class="form-control form-kuesioner" id="b2r203a" tabindex="10" onfocus='this.select();'
                          maxlength="15"></input></td>
                      <td><input class="form-control form-kuesioner" id="b2r203b" tabindex="11" onfocus='this.select();'
                          maxlength="15"></input></td>
                    </tr>
                    <tr>
                      <td>204. Tanda Tangan</td>
                      <td class="text-center">ttd</td>
                      <td class="text-center">ttd</td>
                    </tr>
                  </tbody>
                </table>
                <br>
                <br>
                <table class="table table-responsive-sm table-bordered table-sm table-hover">
                  <thead>
                    <tr class="judulBlokKuesioner">
                      <th colspan="2"><b>BLOK III. PENGESAHAN KEPALA DESA/LURAH</b></th>
                    </tr>
                  </thead>
                  <tbody id="tbodyOperator">
                    <tr>
                      <td width="30%">301. Nama</td>
                      <td width="70%"><input class="form-control form-kuesioner" id="b3r301" tabindex="12"
                          onfocus='this.select();' maxlength="50"></input></td>
                    </tr>
                    <tr>
                      <td width="30%">302. Tanggal Pengesahan</td>
                      <td width="70%">
                        <table class="table-borderless">
                          <tr>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b3r302_dd" tabindex="13"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b3r302_mm" tabindex="14"
                                onfocus='this.select();' style="width: 50px" maxlength="2" maxlength="2"></input>
                            </td>
                            <td>/</td>
                            <td>
                              <input class="form-control form-kuesioner text-center" id="b3r302_yy" tabindex="15"
                                onfocus='this.select();' style="width: 80px" maxlength="4" maxlength="4"></input>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                    <tr>
                      <td width="30%">303. Nomor HP</td>
                      <td width="70%"><input class="form-control form-kuesioner" id="b3r303" tabindex="16"
                          maxlength="15" onkeypress='nextPage(this.tabIndex, event)'></input></td>
                    </tr>
                    <tr>
                      <td width="30%">304. Tanda Tangan dan Stempel</td>
                      <td width="70%" class="text-center">ttd</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- /.row-->
          </div>
        </div>
      </div>
      <!-- /.col-->
    </div>
    <!-- /.row-->
  </div>
</div>

<!-- modal tutupEntrianModal -->
<div class="modal fade" id="tutupEntrianModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Konfirmasi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Apakah anda ingin menyimpan perubahan data?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal"
          onclick="tutupEntrianSamasta1('yes')">Simpan</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
          onclick="tutupEntrianSamasta1('no')">Tidak</button>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    //$('.sidebar-toggler').click();
    loadEntrian();
    //document.getElementById("loader").style.display = "none";
    $(".overlay").hide();
  });
</script>

<script>
  async function loadEntrian() {
    // jika statusEntrian new, load dari json
    await getEntriSessionDataSamasta1();
    //if (statusEntrian == 'new') {
    await bacaIsiJsonSamasta1();

    let sql = `SELECT * FROM m_desa AS e 
        LEFT JOIN m_prov AS a ON e.kodeProv = a.kodeProv 
        LEFT JOIN m_kab AS b ON e.kodeProv = b.kodeProv AND e.kodeKab = b.kodeKab
        LEFT JOIN m_kec AS c ON e.kodeProv = c.kodeProv AND e.kodeKab = c.kodeKab AND e.kodeKec = c.kodeKec
        WHERE e.kodeProv = '${kodeProv}' AND e.kodeKab  = '${kodeKab}' AND e.kodeKec = '${kodeKec}' AND e.kodeDesa = '${kodeDesa}'`;
    r = await sqlite.get(sql)
    if (r) {
      document.getElementById('b1r101').value = r.namaProv;
      document.getElementById('b1r102').value = r.namaKab;
      document.getElementById('b1r103').value = r.namaKec;
      document.getElementById('b1r104').value = r.namaDesa;
      document.getElementById('b1r105').value = b1r105;
      document.getElementById('b2r201a').value = b2r201a;
      document.getElementById('b2r201b').value = b2r201b;
      document.getElementById('b2r202a_dd').value = b2r202a_dd;
      document.getElementById('b2r202a_mm').value = b2r202a_mm;
      document.getElementById('b2r202a_yy').value = b2r202a_yy;
      document.getElementById('b2r202b_dd').value = b2r202b_dd;
      document.getElementById('b2r202b_mm').value = b2r202b_mm;
      document.getElementById('b2r202b_yy').value = b2r202b_yy;
      document.getElementById('b2r203a').value = b2r203a;
      document.getElementById('b2r203b').value = b2r203b;
      document.getElementById('b3r301').value = b3r301;
      document.getElementById('b3r302_dd').value = b3r302_dd;
      document.getElementById('b3r302_mm').value = b3r302_mm;
      document.getElementById('b3r302_yy').value = b3r302_yy;
      document.getElementById('b3r303').value = b3r303;
    }
    document.getElementById("b1r105").focus();
  }

  function updateIsiJsonSamasta1() {
    const fs = require('fs');

    let rawdata = fs.readFileSync(dlPathData + `entriSamasta1/${namaFile}.json`);
    let dataDesa = JSON.parse(rawdata);

    dataDesa.b1r105 = document.getElementById("b1r105").value.toUpperCase();
    dataDesa.b2r201a = document.getElementById("b2r201a").value.toUpperCase();
    dataDesa.b2r201b = document.getElementById("b2r201b").value.toUpperCase();
    dataDesa.b2r202a_dd = document.getElementById("b2r202a_dd").value;
    dataDesa.b2r202a_mm = document.getElementById("b2r202a_mm").value;
    dataDesa.b2r202a_yy = document.getElementById("b2r202a_yy").value;
    dataDesa.b2r202b_dd = document.getElementById("b2r202b_dd").value;
    dataDesa.b2r202b_mm = document.getElementById("b2r202b_mm").value;
    dataDesa.b2r202b_yy = document.getElementById("b2r202b_yy").value;
    dataDesa.b2r203a = document.getElementById("b2r203a").value;
    dataDesa.b2r203b = document.getElementById("b2r203b").value;
    dataDesa.b3r301 = document.getElementById("b3r301").value.toUpperCase();
    dataDesa.b3r302_dd = document.getElementById("b3r302_dd").value;
    dataDesa.b3r302_mm = document.getElementById("b3r302_mm").value;
    dataDesa.b3r302_yy = document.getElementById("b3r302_yy").value;
    dataDesa.b3r303 = document.getElementById("b3r303").value;
    dataDesa.statusDok = statusDok;

    fs.writeFileSync(dlPathData + `entriSamasta1/${namaFile}.json`, JSON.stringify(dataDesa));
  }
</script>

<script>
  function pindahHalaman(from, to) {
    if (from == 1) {
      updateIsiJsonSamasta1();
    }
    location.href = `#/samasta-1/${to}/`;
  }
</script>

<script>
  function nextPage(i, e) {
    var maxTabIndex = i;
    var keycode = (e.keyCode ? e.keyCode : e.which);
    if (keycode == '13') {
      if (document.getElementById('b3r303').tabIndex == maxTabIndex) {
        updateIsiJsonSamasta1();
        location.href = `#/samasta-1/2/`;
      }
    }
  }
</script>

<script>
  tabindexFix();
</script>

<script>
  $(document).ready(function () {
    // Install input filters.
    $("#b1r105").inputFilter(function (value) {
      return /^[a-zA-Z0-9 .,/]*$/i.test(value);
    });
    $("#b2r201a").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b2r201b").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b2r202a_dd").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 31);
    });
    $("#b2r202a_mm").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 12);
    });
    $("#b2r202a_yy").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 2100);
    });
    $("#b2r202b_dd").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 31);
    });
    $("#b2r202b_mm").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 12);
    });
    $("#b2r202b_yy").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 2100);
    });
    $("#b2r203a").inputFilter(function (value) {
      return /^\d*$/.test(value);
    });
    $("#b2r203b").inputFilter(function (value) {
      return /^\d*$/.test(value);
    });

    $("#b3r301").inputFilter(function (value) {
      return /^[a-zA-Z\s]*$/i.test(value);
    });
    $("#b3r302_dd").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 31);
    });
    $("#b3r302_mm").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 12);
    });
    $("#b3r302_yy").inputFilter(function (value) {
      return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 2100);
    });
    $("#b3r303").inputFilter(function (value) {
      return /^\d*$/.test(value);
    });
  });
</script>